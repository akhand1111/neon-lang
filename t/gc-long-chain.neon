IMPORT runtime

TYPE Node IS RECORD
    next: POINTER TO Node
    value: Number
END RECORD

FUNCTION make(next: POINTER TO Node): POINTER TO Node
    LET n: POINTER TO Node := NEW Node
    n->next := next
    RETURN n
END FUNCTION

VAR a: POINTER TO Node := NIL

ASSERT runtime.get_allocated_object_count() = 0
FOR i := 1 TO 10000 DO
    a := make(a)
    ASSERT i = runtime.get_allocated_object_count()
END FOR
a := NIL
runtime.garbage_collect()
ASSERT runtime.get_allocated_object_count() = 0
